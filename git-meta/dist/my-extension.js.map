{"version":3,"sources":["../node_modules/sourcegraph/src/index.js","my-extension.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;ACNA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,MAAM,iBAAiB,GAAI,QAAD,IAAwC,OAAO,CAAC,OAAR,CAAgB,IAAhB,CAAlE;;AAEA,MAAM,WAAW,GAAG,CAAC;AAAE,EAAA;AAAF,CAAD,KAA2D;AAC3E,QAAM;AAAE,IAAA,QAAF;AAAY,IAAA;AAAZ,MAAyB,IAAI,GAAJ,CAAQ,GAAR,CAA/B;AACA,SAAO,GAAG,QAAQ,GAAG,QAAQ,EAA7B;AACH,CAHD;;AAKA,MAAM,yBAAyB,GAAG,CAAC;AAAE,EAAA;AAAF,CAAD,KAA2F;AAAA,MAAA,EAAA,EAAA,EAAA;;AAAA,SAAA,EAAA,GAAA,CAAA,EAAA,GACzH,IADyH,MACrH,IADqH,IACrH,EAAA,KAAA,KAAA,CADqH,GACrH,KAAA,CADqH,GACrH,EAAA,CAAE,KAAF,CAAQ,IAAR,EACC,GADD,CACK,CAAC,CAAD,EAAI,KAAJ,MAAmD;AACpD,IAAA,KAAK,EAAE,IAAI,WAAW,CAAC,KAAhB,CACH,IAAI,WAAW,CAAC,QAAhB,CAAyB,KAAzB,EAAgC,CAAhC,CADG,EAEH,IAAI,WAAW,CAAC,QAAhB,CAAyB,KAAzB,EAAgC,CAAhC,CAFG,CAD6C;AAKpD,IAAA,eAAe,EAAE;AALmC,GAAnD,CADL,CADqH,EAQnH,EAAA,KAAA,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,EAAA,GACH,EATsH;AASpH,CATT;;AAWM,SAAU,QAAV,CAAmB,GAAnB,EAAoD;AACtD,QAAM,cAAc,GAAG,WAAW,CAAC,GAAZ,CAAgB,oBAAhB,EAAvB;AAEA,QAAM,mBAAmB,GAEzB,GAAG,CAAC,aAAJ,CAAkB,GAAlB,CACI,WAAW,CAAC,GAAZ,CAAgB,mBAAhB,CAAoC,SAApC,CAA8C,YAAY,IAAG;AACzD,QAAI,CAAC,YAAL,EAAmB;AACf;AACH;;AACD,IAAA,GAAG,CAAC,aAAJ,CAAkB,GAAlB,CACI,YAAY,CAAC,0BAAb,CAAwC,SAAxC,CAAwD,MAAN,IAAe,SAAA,CAAA,IAAA,EAAA,KAAA,CAAA,EAAA,KAAA,CAAA,EAAA,aAAA;AAC7D,UAAI,CAAC,MAAL,EAAa;AACT;AACH;;AACD,YAAM,OAAO,GAAG,MAAM,iBAAiB,CAAC,WAAW,CAAC,MAAM,CAAC,QAAR,CAAZ,CAAvC,CAJ6D,CAK7D;;AACA,UAAI,OAAJ,EAAa;AACT,QAAA,MAAM,CAAC,cAAP,CAAsB,cAAtB,EAAsC,yBAAyB,CAAC,MAAM,CAAC,QAAR,CAA/D;AACH;AACJ,KATgE,CAAjE,CADJ;AAYH,GAhBD,CADJ,CAFA;AAsBA,EAAA,WAAW,CAAC,MAAZ,CAAmB,wBAAnB,CAA4C;AACxC;AACA,IAAA,cAAc,EAAE,KAAK,IAAI,GAAG,KAAK;AAFO,GAA5C;AAIH","file":"my-extension.js","sourceRoot":"../src","sourcesContent":["// This is the module that is bundled with extensions when they use `import ... from 'sourcegraph'` or\n// `require('sourcegraph')`. It delegates to the extension host's runtime implementation of this module by calling\n// `global.require` (which ensures that the extension host's `require` is called at runtime).\n//\n// This dummy file is used when the extension is bundled with a JavaScript bundler that lacks support for externals\n// (or when `sourcegraph` is not configured as an external module). Parcel does not support externals\n// (https://github.com/parcel-bundler/parcel/issues/144). Webpack, Rollup, and Microbundle support externals.\nmodule.exports = global.require('sourcegraph')\n","import { from } from 'rxjs'\nimport { from } from 'rxjs/operators'\nimport * as sourcegraph from 'sourcegraph'\n\nconst repositoryDeleted = (repoName: string): Promise<boolean> => Promise.resolve(true)\n\nconst getRepoName = ({ uri }: Pick<sourcegraph.TextDocument, 'uri'>): string => {\n    const { hostname, pathname } = new URL(uri)\n    return `${hostname}${pathname}`\n}\n\nconst getDeletedFileDecorations = ({ text }: Pick<sourcegraph.TextDocument, 'text'>): sourcegraph.TextDocumentDecoration[] =>\n    text?.split(`\\n`)\n        .map((_, index): sourcegraph.TextDocumentDecoration => ({\n            range: new sourcegraph.Range(\n                new sourcegraph.Position(index, 0),\n                new sourcegraph.Position(index, 0)\n            ),\n            backgroundColor: 'hsl(0, 50%, 50%)'\n        }))\n    ?? []\n\nexport function activate(ctx: sourcegraph.ExtensionContext): void {\n    const decorationType = sourcegraph.app.createDecorationType()\n\n    const activeEditorChanges =\n\n    ctx.subscriptions.add(\n        sourcegraph.app.activeWindowChanges.subscribe(activeWindow => {\n            if (!activeWindow) {\n                return\n            }\n            ctx.subscriptions.add(\n                activeWindow.activeViewComponentChanges.subscribe(async editor => {\n                    if (!editor) {\n                        return\n                    }\n                    const deleted = await repositoryDeleted(getRepoName(editor.document))\n                    // Add a red background color to code views in deleted repositories.\n                    if (deleted) {\n                        editor.setDecorations(decorationType, getDeletedFileDecorations(editor.document))\n                    }\n                })\n            )\n        })\n    )\n\n    sourcegraph.search.registerQueryTransformer({\n        // Register a query transformer to exclude deleted repositories.\n        transformQuery: query => `${query} -r:^bitbucket\\.sgdev\\.org/SGDEMO`\n    })\n}\n"]}